function Listing(opt_options){opt_options=opt_options||{};this.param_={};this.param_.table_=opt_options.table||null;this.param_.th_=opt_options.th||null;this.param_.td_=opt_options.td||null;this.param_.style_=opt_options.style||null;this.param_.prevBtn_=opt_options.prevBtn||null;this.param_.nextBtn_=opt_options.nextBtn||null;this.param_.pageNow_=opt_options.pageNow||null;this.param_.pageTotal_=opt_options.pageTotal||null;this.param_.begin_=0;this.param_.pages_=10;this.param_.filter_=null;this.param_.defaultStyle_=opt_options.defaultStyle_||false;this.param_.record_=[];this.setOption_(opt_options,true)}Listing.prototype.dataQuery_=function(filter,datas){datas=datas||this.param_.record_;filter=filter||this.param_.filter_;var reply=[];if(filter){$(datas).each(function(i,data){if(!!filter(data)){reply.push(data)}})}else{reply=datas}return reply};Listing.prototype.dataPage_=function(datas){begin=this.param_.begin_*this.param_.pages_;pages=this.param_.pages_;datas=datas||this.param_.record_;var reply=[];$(datas).each(function(key,data){if(key>=begin&&key<begin+pages){reply.push(data)}});return reply};Listing.prototype.initTh_=function(th){this.param_.th_=th||this.param_.th_;if(this.param_.th_&&this.param_.table_){var arr=[],item={};this.param_.table_.find("th").remove();$(this.param_.th_).each(function(key,val){item={val:"-"};if(typeof val=="object"){item["val"]=val.val;item["css"]=val.css}else{item["val"]=val}item["key"]="th";arr.push(item)});this.innerHtml_(arr)}};Listing.prototype.templet_=function(data){var templet=[],temp=null,reg=null;$(this.param_.td_).each(function(i,val){if(typeof val=="object"){temp=new Object();for(var k in val){temp[k]=val[k]}for(var key in data){if(temp.val.indexOf("{{"+key+"}}")>=0){reg=new RegExp("{{"+key+"}}","g");temp.val=temp.val.replace(reg,data[key])}}}else{for(var key in data){if(val.indexOf("{{"+key+"}}")>=0){reg=new RegExp("{{"+key+"}}","g");temp=val.replace(reg,data[key])}}}templet.push(temp)});return templet};Listing.prototype.initTd_=function(td,data){var arr=[];if(td){$(td).each(function(i,val){item={val:"-"};if(typeof val=="object"){for(var key in val){item[key]=val[key]}}else{item["val"]=val}arr.push(item)});this.innerHtml_(arr,data)}return arr};Listing.prototype.listView_=function(data){data=data||this.param_.record_;var that=this;data=this.dataQuery_();data=this.dataPage_(data);$(data).each(function(key,val){var info=that.templet_(val);that.initTd_(info,val)})};Listing.prototype.listLoading_=function(msg){msg=msg||"Loading...";var len=1;if(this.param_.th_){len=this.param_.th_.length}this.innerHtml_([{val:msg,attr:{colspan:len},css:{textAlign:"center",color:"#aaa"}}])};Listing.prototype.listNot_=function(msg){msg=msg||"Sorry! Query less than specified data.";var len=1;if(this.param_.th_){len=this.param_.th_.length}this.innerHtml_([{val:msg,attr:{colspan:len},css:{textAlign:"center",color:"#aaa"}}])};Listing.prototype.isArr_=function(value){return Object.prototype.toString.call(value)=="[object Array]"};Listing.prototype.isObj_=function(value){return Object.prototype.toString.call(value)=="[object Object]"};Listing.prototype.event_=function(e,td,control,data){var ev=e.replace("on",""),el=td.find(control.key);el.unbind(ev).bind(ev,function(){control[e](el,td,data)})};Listing.prototype.binding_=function(td,control,data){var that=this;for(var k in control){if(k.indexOf("on")==0){that.event_(k,td,control,data)}if(k=="init"){control[k](td.find(control.key),td,data)}if(k=="css"){td.find(control.key).css(control[k])}if(k=="className"){el.find(control.key).attr("class",control[k])}}};Listing.prototype.listStyle_=function(el){var style={th:{backgroundColor:"#ccc",lineHeight:"33px"},td:{lineHeight:"33px"},odd:function(i){return i%2==0},shade:{backgroundColor:"#eee",},hover:{backgroundColor:"#ddd",}},defaultStyle=this.param_.defaultStyle_;if(defaultStyle&&this.isObj_(defaultStyle)){for(var key in defaultStyle){style[key]=defaultStyle[key]}}if(!el){return}if(style.odd(el.index())){el.css(style.shade)}if(el.find("th").length){el.css(style.th)}else{el.css(style.td)}el.mouseenter(function(){var el=$(this),bg=el.css("backgroundColor");el.attr("bg",bg);el.find("td").css(style.hover)});el.mouseleave(function(){var el=$(this),bg=el.attr("bg");el.removeAttr("bg");el.find("td").css("backgroundColor","")})};Listing.prototype.innerHtml_=function(newValue,newData){newData=newData||{};var that=this,list=this.param_.table_,comm=this.param_.style_||{},newTr=null,newEl=null;if(!list){return}if(comm.table){list.css(comm.table)}if(newValue[0].key&&newValue[0].key=="th"){if(list.find("thead").length==0){list.append("<thead></thead>")}list=list.find("thead")}if(!newValue[0].key||newValue[0].key!="th"){if(list.find("tbody").length==0){list.append("<tbody></tbody>")}list=list.find("tbody")}list.append("<tr></tr>");newTr=list.find("tr:last");$(newValue).each(function(i,data){if(Object.prototype.toString.call(data)=="[object String]"){newTr.append("<td>"+data+"</td>");newEl=newTr.find("td:last")}if(Object.prototype.toString.call(data)=="[object Object]"){if(data.key&&data.key=="th"){newTr.append("<th>"+data.val+"</th>");newEl=newTr.find("th:last")}else{newTr.append("<td>"+data.val+"</td>");newEl=newTr.find("td:last")}}if(that.param_.defaultStyle_){that.listStyle_(newTr)}if((!data.key||data.key!="th")&&comm.td){newEl.css(comm.td)}if((data.key||data.key=="th")&&comm.th){newEl.css(comm.th)}if(data.css){newEl.css(data.css)}if(data.attr){newEl.attr(data.attr)}for(var key in data){if(newEl.find(key).length>0){data[key](newEl.find(key),newData)}}if(data.control&&that.isArr_(data.control)){$(data.control).each(function(i,control){that.binding_(newEl,control,newData)})}if(data.control&&that.isObj_(data.control)){that.binding_(newEl,data.control,newData)}})};Listing.prototype.sortDate_=function(key,way){key=key||"alias";way=way||false;var av,bv;this.param_.record_.sort(function(a,b){if(String(a[key]).length&&String(b[key]).length){av=a[key];bv=b[key];if(typeof a[key]=="string"){av=String(a[key]).toUpperCase();bv=String(b[key]).toUpperCase()}if(av<bv){return Boolean(way)?1:-1}else{if(av>bv){return Boolean(way)?-1:1}else{return 0}}}})};Listing.prototype.getPageInfo_=function(){var info=this.dataQuery_();var total=info.length,number=this.param_.pages_,pages=Math.ceil(total/number),current=this.param_.begin_;return{"total":total,"pages":pages,"number":number,"current":current+1}};Listing.prototype.outPageInfo_=function(info){var that=this;if(this.param_.pageNow_){this.param_.pageNow_.html(info.current)}if(this.param_.pageTotal_){this.param_.pageTotal_.html(info.pages)}if(this.param_.nextBtn_){if(info.current>=info.pages){this.param_.nextBtn_.addClass("disabledButton").attr("disabled",true)}else{this.param_.nextBtn_.removeClass("disabledButton").attr("disabled",false)}this.param_.nextBtn_.unbind("click").click(function(){if(that.param_.begin_+1<that.getPageInfo_().pages){that.setOption_({begin:that.param_.begin_+1},true)}})}if(this.param_.prevBtn_){if(info.current<=1){this.param_.prevBtn_.addClass("disabledButton").attr("disabled",true)}else{this.param_.prevBtn_.removeClass("disabledButton").attr("disabled",false)}this.param_.prevBtn_.unbind("click").click(function(){if(that.param_.begin_-1>=0){that.setOption_({begin:that.param_.begin_-1},true)}})}return info};Listing.prototype.emptyTable_=function(){if(this.param_.table_){this.param_.table_.empty()}};Listing.prototype.removeTd_=function(){if(this.param_.table_){this.param_.table_.find("tr:gt(0)").remove()}};Listing.prototype.reviseData_=function(array){$(array).each(function(i,obj){$.extend(obj,{set:function(value){for(var key in value){if($.type(obj[key])!="undefined"){obj[key]=value[key]}}}})})};Listing.prototype.setOption_=function(param,refresh){param=param||{};refresh=refresh;var that=this;for(var key in param){that.param_[key+"_"]=param[key]||null}this.reviseData_(this.param_.record_);if(refresh){this.emptyTable_();this.initTh_();this.listView_();this.onpage()}};Listing.prototype.empty=function(){this.removeTd_()};Listing.prototype.loading=function(){this.removeTd_();this.listLoading_()};Listing.prototype.nothing=function(msg){this.removeTd_();this.listNot_(msg)};Listing.prototype.sort=function(key,way){if(key){this.sortDate_(key,way)}this.empty();this.view()};Listing.prototype.onpage=function(){var info=null;if(this.param_.record_.length){info=this.getPageInfo_();this.outPageInfo_(info)}};Listing.prototype.set=function(param,refresh){this.setOption_(param,refresh)};Listing.prototype.view=function(data){data=data||this.param_.record_;this.setOption_({record:data},true)};Listing.prototype.filter=function(way){if(way){this.setOption_({filter:way,begin:0},true)}};