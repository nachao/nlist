function Listing(a){a=a||{};this.param_={};this.param_.table_=a.table||null;this.param_.th_=a.th||null;this.param_.td_=a.td||null;this.param_.style_=a.style||null; this.param_.prevBtn_=a.prevBtn||null;this.param_.nextBtn_=a.nextBtn||null;this.param_.pageNow_=a.pageNow||null;this.param_.pageTotal_=a.pageTotal||null; this.param_.begin_=0;this.param_.pages_=10;this.param_.filter_=null;this.param_.defaultStyle_=a.defaultStyle_||false;this.param_.record_=[];this.dataSet_(a,true); }Listing.prototype.dataQuery_=function(c,a){a=a||this.param_.record_;c=c||this.param_.filter_;var b=[];if(c){$(a).each(function(d,e){if($.type(c)=="function"&&!!c(e)){b.push(e); }});}else{b=a;}return b;};Listing.prototype.dataSort_=function(c,b){var d,a;this.param_.record_.sort(function(f,e){if($.isFunction(c)){return c(f,e);}else{if(String(f[c]).length&&String(e[c]).length){d=f[c]; a=e[c];if(typeof f[c]=="string"){d=String(f[c]).toUpperCase();a=String(e[c]).toUpperCase();}if(d<a){return Boolean(b)?1:-1;}else{if(d>a){return Boolean(b)?-1:1; }else{return 0;}}}}});};Listing.prototype.dataPage_=function(a){begin=this.param_.begin_*this.param_.pages_;pages=this.param_.pages_;a=a||this.param_.record_; var b=[];$(a).each(function(c,d){if(c>=begin&&c<begin+pages){b.push(d);}});return b;};Listing.prototype.dataRevise_=function(b){var a=this;$(b).each(function(c,d){$.extend(d,{set:function(f){for(var e in f){if($.type(d[e])!="undefined"){d[e]=f[e]; }}},that:a});});};Listing.prototype.dataSet_=function(d,b){d=d||{};b=b;var c=this;for(var a in d){if(a=="msg"){continue;}c.param_[a+"_"]=d[a]||null;}if(d.record){this.dataRevise_(this.param_.record_); }if(b){if(d.th){this.tableEmpty_();this.dataInitTh_();}else{this.tableRemoveTd_();}this.dataView_();this.onpage();}};Listing.prototype.dataInit_=function(c,a){var d=[],b={}; $(c).each(function(e,f){b={val:"-"};if($.isPlainObject(f)){b=$.extend({},f);}else{b.val=f;}if(a){b.key=a;}d.push(b);});return d;};Listing.prototype.dataInitTh_=function(){if(this.param_.th_&&this.param_.table_){this.tableInner_(this.dataInit_(this.param_.th_,"th"),this); }};Listing.prototype.dataInitTd_=function(a,b){if(a&&this.param_.table_){this.tableInner_(this.dataInit_(a,"td"),b);}};Listing.prototype.dataTemplet_=function(d){var b=[],a=null,c=null; $(this.param_.td_).each(function(f,g){if($.type=="string"){a={val:g};}else{if($.isPlainObject(g)){a=$.extend({},g);}}for(var e in d){if(a.val&&a.val.indexOf("{{"+e+"}}")>=0){c=new RegExp("{{"+e+"}}","g"); a.val=a.val.replace(c,d[e]);}}b.push(a);});return b;};Listing.prototype.dataView_=function(b){b=b||this.param_.record_;var a=this;b=this.dataQuery_();b=this.dataPage_(b); console.log(b);$(b).each(function(c,d){a.dataInitTd_(a.dataTemplet_(d),d);});};Listing.prototype.hintLoading_=function(b){b=b||"Loading...";var a=1;if(this.param_.th_){a=this.param_.th_.length; }this.tableInner_([{val:b,attr:{colspan:a},css:{textAlign:"center",color:"#aaa"}}]);};Listing.prototype.hintNot_=function(b){b=b||"Empty.";var a=1;if(this.param_.th_){a=this.param_.th_.length; }this.tableInner_([{val:b,attr:{colspan:a},css:{textAlign:"center",color:"#aaa"}}]);};Listing.prototype.tableEvent_=function(f,g,d,c){var b=f.replace("on",""),a=g.find(d.key); a.unbind(b).bind(b,function(){d[f](a,g,c);});};Listing.prototype.tableBinding_=function(e,d,c){var b=this;for(var a in d){if(a.indexOf("on")==0){b.tableEvent_(a,e,d,c); }if(a=="init"){d[a](e.find(d.key),e,c);}if(a=="css"){e.find(d.key).css(d[a]);}if(a=="className"){el.find(d.key).attr("class",d[a]);}}};Listing.prototype.tableStyle_=function(c){var b={th:{backgroundColor:"#ccc",lineHeight:"33px"},td:{lineHeight:"33px"},odd:function(e){return e%2==0; },shade:{backgroundColor:"#eee",},hover:{backgroundColor:"#ddd",}},d=this.param_.defaultStyle_;if(d&&$.isPlainObject(d)){for(var a in d){b[a]=d[a];}}if(!c){return; }if(b.odd(c.index())){c.css(b.shade);}if(c.find("th").length){c.css(b.th);}else{c.css(b.td);}c.mouseenter(function(){var f=$(this),e=f.css("backgroundColor"); f.attr("bg",e);f.find("td").css(b.hover);});c.mouseleave(function(){var f=$(this),e=f.attr("bg");f.removeAttr("bg");f.find("td").css("backgroundColor",""); });};Listing.prototype.tableInner_=function(f,c){c=c||{};var d=this,e=this.param_.table_,b=this.param_.style_||{},a=null,g=null;if(!e){return;}if(b.table){e.css(b.table); }if(f[0].key&&f[0].key=="th"){if(e.find("thead").length==0){e.append("<thead></thead>");}e=e.find("thead");}if(!f[0].key||f[0].key!="th"){if(e.find("tbody").length==0){e.append("<tbody></tbody>"); }e=e.find("tbody");}e.append("<tr></tr>");a=e.find("tr:last");$(f).each(function(j,k){if($.type(k)=="string"){a.append("<td>"+k+"</td>");g=a.find("td:last"); }if($.isPlainObject(k)){if(k.key=="th"){a.append("<th>"+k.val+"</th>");g=a.find("th:last");}else{a.append("<td>"+k.val+"</td>");g=a.find("td:last");}}if(d.param_.defaultStyle_){d.tableStyle_(a); }if((!k.key||k.key!="th")&&b.td){g.css(b.td);}if((k.key||k.key=="th")&&b.th){g.css(b.th);}if(k.css){g.css(k.css);}if(k.attr){g.attr(k.attr);}for(var h in k){if(g.find(h).length>0){k[h](g.find(h),c); }if(h=="init"){k.init(g,c);}}if(k.control&&$.isArray(k.control)){$(k.control).each(function(l,m){d.tableBinding_(g,m,c);});}if(k.control&&$.isPlainObject(k.control)){d.tableBinding_(g,k.control,c); }});};Listing.prototype.pageGet_=function(){var e=this.dataQuery_();var c=e.length,b=this.param_.pages_,a=Math.ceil(c/b),d=this.param_.begin_;return{total:c,pages:a,number:b,current:d+1}; };Listing.prototype.pageDisplay_=function(b){var a=this;if(this.param_.pageNow_){this.param_.pageNow_.html(b.current);}if(this.param_.pageTotal_){this.param_.pageTotal_.html(b.pages); }if(this.param_.nextBtn_){if(b.current>=b.pages){this.param_.nextBtn_.addClass("disabledButton").attr("disabled",true);}else{this.param_.nextBtn_.removeClass("disabledButton").attr("disabled",false); }this.param_.nextBtn_.unbind("click").click(function(){if(a.param_.begin_+1<a.pageGet_().pages){a.dataSet_({begin:a.param_.begin_+1},true);}});}if(this.param_.prevBtn_){if(b.current<=1){this.param_.prevBtn_.addClass("disabledButton").attr("disabled",true); }else{this.param_.prevBtn_.removeClass("disabledButton").attr("disabled",false);}this.param_.prevBtn_.unbind("click").click(function(){if(a.param_.begin_-1>=0){a.dataSet_({begin:a.param_.begin_-1},true); }});}return b;};Listing.prototype.tableEmpty_=function(){if(this.param_.table_){this.param_.table_.empty();}};Listing.prototype.tableRemoveTd_=function(){if(this.param_.table_){this.param_.table_.find("tr:gt(0)").remove(); }};Listing.prototype.empty=function(){this.tableRemoveTd_();};Listing.prototype.loading=function(){this.tableRemoveTd_();this.hintLoading_();};Listing.prototype.nothing=function(a){this.tableRemoveTd_(); this.hintNot_(a);};Listing.prototype.sort=function(b,a){if(b){this.dataSort_(b,a);}this.empty();this.view();};Listing.prototype.onpage=function(){var a=null; if(this.param_.record_.length){a=this.pageGet_();this.pageDisplay_(a);}};Listing.prototype.set=function(b,a){this.dataSet_(b,a);};Listing.prototype.view=function(a){a=a||this.param_.record_; this.dataSet_({msg:"输出数据",record:a},true);};Listing.prototype.filter=function(a){if(a){this.dataSet_({msg:"排序数据",filter:a,begin:0},true);}};